<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Laser - Intranet</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-circle">
                <img id="main-logo-img" src="" alt="Santo Laser Logo" class="main-logo">
            </div>
            <h1 class="sidebar-title">SANTO LASER</h1>
        </div>
        <nav>
            <a href="#" class="nav-item active" onclick="showSection('dashboard')"><i class="fa-solid fa-chart-line"></i> DASHBOARD</a>
            <a href="#" class="nav-item" onclick="showSection('crm')"><i class="fa-solid fa-users"></i> CRM</a>
            <a href="#" class="nav-item" onclick="showSection('calculator')"><i class="fa-solid fa-calculator"></i> CALCULADORA OS</a>
            <a href="#" class="nav-item" onclick="showSection('cashflow')"><i class="fa-solid fa-money-bill-transfer"></i> FLUXO DE CAIXA</a>
            <a href="#" class="nav-item" onclick="showSection('dre')"><i class="fa-solid fa-file-invoice-dollar"></i> DRE</a>
            <a href="#" class="nav-item" onclick="showSection('simulator')"><i class="fa-solid fa-bullseye"></i> SIMULADOR METAS</a>
            <a href="#" class="nav-item" onclick="showSection('stock')"><i class="fa-solid fa-boxes-stacked"></i> ESTOQUE</a>
            <a href="#" class="nav-item" onclick="showSection('settings')"><i class="fa-solid fa-gear"></i> CONFIGURA칂칏ES</a>
        </nav>
        <div class="backup-area">
            <button class="btn-modern btn-outline" onclick="exportToExcel()"><i class="fa-solid fa-file-excel"></i> EXPORTAR EXCEL</button>
        </div>
        <div class="theme-switch">
            <button id="theme-toggle" class="btn-theme" onclick="toggleTheme()">
                <i class="fa-solid fa-moon"></i> <span>MODO ESCURO</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <!-- ======================= DASHBOARD ======================= -->
        <div id="dashboard-content" class="content-section active">
            <header>
                <h2>PAINEL DE SA칔DE</h2>
                <div class="filter-bar mini">
                    <input type="month" id="dash-month-filter" onchange="updateDashboard()">
                </div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <small>Receita Bruta</small>
                    <span class="value" id="dash-faturamento">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Margem de Lucro</small>
                    <span class="value" id="dash-margem">0%</span>
                </div>
                <div class="kpi-card">
                    <small>Ponto de Equil칤brio</small>
                    <span class="value" id="dash-breakeven">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Pedidos Ativos</small>
                    <span class="value" id="dash-pedidos">0</span>
                </div>
            </div>
            <div class="charts-row">
                <div class="chart-container">
                    <h3>Performance Financeira (DRE)</h3>
                    <div class="chart-wrapper"><canvas id="chart-performance"></canvas></div>
                </div>
                <div class="chart-container">
                    <h3>Origem de Clientes Lucrativos</h3>
                    <div class="chart-wrapper"><canvas id="chart-origem"></canvas></div>
                </div>
            </div>
            <div class="dashboard-timeline">
                <div class="chart-container">
                    <h3>Cronograma de Entregas</h3>
                    <div id="timeline-wrapper" class="timeline-container"></div>
                </div>
            </div>
        </div>

        <!-- ======================= CRM ======================= -->
        <div id="crm-content" class="content-section">
            <div class="crm-header">
                <h2>CRM - OPORTUNIDADES</h2>
                <div class="crm-controls">
                    <button class="btn-modern btn-primary" onclick="openLeadModal()">+ NOVO CLIENTE</button>
                    <button class="btn-modern" onclick="toggleCRMView()"><i class="fa-solid fa-table-list"></i> ALTERNAR VIS츾O</button>
                </div>
            </div>
            <div id="kanban-view" class="kanban-container">
                <div class="kanban-column" ondrop="drop(event, 0)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-1">PROPOSTA</span> <span class="count" id="count-0">0</span></div>
                    <div class="kanban-cards" id="cards-0"></div>
                </div>
                <div class="kanban-column" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-2">APROVADO</span> <span class="count" id="count-1">0</span></div>
                    <div class="kanban-cards" id="cards-1"></div>
                </div>
                <div class="kanban-column" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-3">PRODU칂츾O</span> <span class="count" id="count-2">0</span></div>
                    <div class="kanban-cards" id="cards-2"></div>
                </div>
                <div class="kanban-column" ondrop="drop(event, 3)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-4">FINALIZADO</span> <span class="count" id="count-3">0</span></div>
                    <div class="kanban-cards" id="cards-3"></div>
                </div>
                <div class="kanban-column" ondrop="drop(event, 4)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-5">PAGO</span> <span class="count" id="count-4">0</span></div>
                    <div class="kanban-cards" id="cards-4"></div>
                </div>
            </div>
            <div id="table-view" class="table-container" style="display: none;">
                <table class="modern-table">
                    <thead><tr><th>CLIENTE</th><th>EMPRESA</th><th>STATUS</th><th>VALOR</th><th>ENTREGA</th><th>A칂칏ES</th></tr></thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= CALCULADORA ======================= -->
        <div id="calculator-content" class="content-section">
            <div class="calc-main-layout">
                <div class="calc-form-side">
                    <div class="section-header">丘뙖잺 Par칙metros de Custo</div>
                    <div class="field-row">
                        <div class="field-group"><label>Valor Hora (R$)</label><input type="number" id="g_valor_hora" value="100" oninput="calc()"></div>
                        <div class="field-group"><label>Imposto (%)</label><input type="number" id="g_imposto" value="6" oninput="calc()"></div>
                    </div>
                    <div class="field-row">
                        <div class="field-group"><label>Taxa Cart칚o (%)</label><input type="number" id="g_cartao" value="5" oninput="calc()"></div>
                        <div class="field-group"><label>Frete Insumos (R$)</label><input type="number" id="g_frete" value="0" oninput="calc()"></div>
                    </div>
                    <div class="section-header">游녻 Dados do Cliente</div>
                    <div class="field-group"><label>Nome do Cliente</label><input type="text" id="g_cliente" placeholder="Nome Completo" oninput="calc()"></div>
                    <div class="field-group"><label>Data da Proposta</label><input type="date" id="g_data_proposta" oninput="calc()"></div>
                    <div class="section-header">游눑 Itens do Or칞amento</div>
                    <div id="items-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addItem()">+ ADICIONAR ITEM</button>
                    <div class="section-header">游뚴 Log칤stica e Descontos</div>
                    <div class="field-row">
                        <div class="field-group"><label>Frete Cliente (R$)</label><input type="number" id="g_frete_cliente" value="0" oninput="calc()"></div>
                        <div class="field-group"><label>Desconto (%)</label><input type="number" id="g_desconto" value="0" oninput="calc()"></div>
                    </div>
                </div>
                <div class="calc-preview-side">
                    <div class="quote-card-container">
                        <div class="quote-card" id="quote-card">
                            <div class="quote-header">
                                <div class="quote-logo-box"><img id="quote-logo-img" src="" alt="Logo"></div>
                                <div class="quote-meta">
                                    <h2>OR칂AMENTO</h2>
                                    <p id="display_data_proposta"></p>
                                </div>
                            </div>
                            <div class="quote-client-box">
                                <strong>CLIENTE:</strong> <span id="display_nome_cliente"></span>
                            </div>
                            <table class="quote-table">
                                <thead><tr><th>QTD</th><th>DESCRI칂츾O</th><th>TOTAL</th></tr></thead>
                                <tbody id="card-body"></tbody>
                            </table>
                            <div class="quote-footer">
                                <div class="quote-total-row"><span>TOTAL FINAL</span><span id="card_total">R$ 0,00</span></div>
                                <div class="quote-company-info">SANTO LASER | CNPJ: 64.544.332/0001-10</div>
                            </div>
                        </div>
                    </div>
                    <div class="calc-actions">
                        <button class="btn-modern btn-primary" onclick="copyWA()"><i class="fa-brands fa-whatsapp"></i> WHATSAPP</button>
                        <button class="btn-modern btn-success" onclick="sendToCRM()"><i class="fa-solid fa-cloud-arrow-up"></i> SALVAR NO CRM</button>
                        <button class="btn-modern" onclick="window.print()"><i class="fa-solid fa-file-pdf"></i> GERAR PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= FLUXO DE CAIXA ======================= -->
        <div id="cashflow-content" class="content-section">
            <div class="crm-header">
                <h2>FLUXO DE CAIXA</h2>
                <div class="cashflow-controls">
                    <button class="btn-modern" onclick="openInitialBalanceModal()">SALDO INICIAL</button>
                    <button class="btn-modern btn-primary" onclick="openFinanceModal('Entrada')">+ ENTRADA</button>
                    <button class="btn-modern btn-danger" onclick="openFinanceModal('Sa칤da')">- SA칈DA</button>
                </div>
            </div>
            <div class="finance-kpis">
                <div class="kpi-card"><small>Saldo em Conta</small><span class="value" id="fin-saldo">R$ 0,00</span></div>
                <div class="kpi-card"><small>Total Entradas</small><span class="value" id="fin-entradas" style="color:var(--success)">R$ 0,00</span></div>
                <div class="kpi-card"><small>Total Sa칤das</small><span class="value" id="fin-saidas" style="color:var(--danger)">R$ 0,00</span></div>
            </div>
            <div class="filter-bar">
                <div class="filter-group"><label>In칤cio</label><input type="date" id="filter-start" onchange="renderFinance()"></div>
                <div class="filter-group"><label>Fim</label><input type="date" id="filter-end" onchange="renderFinance()"></div>
                <div class="filter-group"><label>Tipo</label><select id="filter-type" onchange="renderFinance()"><option value="">Todos</option><option value="Entrada">Entrada</option><option value="Sa칤da">Sa칤da</option></select></div>
                <div class="filter-group"><label>Categoria</label><select id="filter-cat" onchange="renderFinance()"><option value="">Todas</option></select></div>
                <button class="btn-modern" onclick="clearFinanceFilters()">LIMPAR</button>
            </div>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>DATA</th><th>DESCRI칂츾O</th><th>TIPO</th><th>CATEGORIA</th><th>VALOR</th><th>A칂칏ES</th></tr></thead>
                    <tbody id="finance-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= DRE ======================= -->
        <div id="dre-content" class="content-section">
            <header>
                <h2>DRE - DEMONSTRATIVO DE RESULTADOS</h2>
                <div class="filter-bar mini"><input type="month" id="dre-month-filter" onchange="renderDRE()"></div>
            </header>
            <div class="dre-container">
                <table class="dre-table">
                    <tr class="dre-row-header"><td>DESCRI칂츾O</td><td class="dre-val">VALOR</td><td class="dre-perc">%</td></tr>
                    <tr class="dre-row-main"><td>RECEITA BRUTA (Vendas Pagas)</td><td id="dre-receita-bruta" class="dre-val">R$ 0,00</td><td class="dre-perc">100%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Impostos e Taxas</td><td id="dre-impostos" class="dre-val">R$ 0,00</td><td id="dre-impostos-p" class="dre-perc">0%</td></tr>
                    <tr class="dre-row-main"><td>(=) RECEITA L칈QUIDA</td><td id="dre-receita-liquida" class="dre-val">R$ 0,00</td><td id="dre-receita-liquida-p" class="dre-perc">0%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Custos de Materiais e Produ칞칚o (CPV)</td><td id="dre-cpv" class="dre-val">R$ 0,00</td><td id="dre-cpv-p" class="dre-perc">0%</td></tr>
                    <tr class="dre-row-main"><td>(=) LUCRO BRUTO</td><td id="dre-lucro-bruto" class="dre-val">R$ 0,00</td><td id="dre-lucro-bruto-p" class="dre-perc">0%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Despesas Operacionais (Fixas/Marketing)</td><td id="dre-despesas" class="dre-val">R$ 0,00</td><td id="dre-despesas-p" class="dre-perc">0%</td></tr>
                    <tr class="dre-row-main highlight"><td>(=) RESULTADO L칈QUIDO (LUCRO/PREJU칈ZO)</td><td id="dre-resultado" class="dre-val">R$ 0,00</td><td id="dre-resultado-p" class="dre-perc">0%</td></tr>
                </table>
            </div>
        </div>

        <!-- ======================= SIMULADOR METAS ======================= -->
        <div id="simulator-content" class="content-section">
            <div class="simulator-layout">
                <div class="sim-sidebar">
                    <div class="section-header">游꿢 Planejamento</div>
                    <div class="field-group"><label id="label-prolabore">Pr칩-labore</label><input type="number" id="sim-prolabore" value="2500" oninput="runSimulator()"></div>
                    <div class="field-group"><label id="label-custos-fixos">Fixos</label><input type="number" id="sim-fixos" value="1000" oninput="runSimulator()"></div>
                    <div class="field-group"><label id="label-marketing">Marketing</label><input type="number" id="sim-marketing" value="200" oninput="runSimulator()"></div>
                    <div class="field-group"><label id="label-reserva">Reserva</label><input type="number" id="sim-reserva" value="500" oninput="runSimulator()"></div>
                    <div class="sim-total-meta"><small>META DE LUCRO</small><h2 id="sim-meta-total">R$ 0,00</h2></div>
                </div>
                <div class="sim-main">
                    <div class="section-header">游늵 Simula칞칚o de Vendas</div>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead><tr><th>PRODUTO/SERVI칂O</th><th>PRE칂O VENDA</th><th>MARGEM (%)</th><th>VENDAS ATUAIS</th><th>VENDAS NECESS츼RIAS</th><th>A칂칏ES</th></tr></thead>
                            <tbody id="sim-table-body"></tbody>
                        </table>
                    </div>
                    <button class="btn-modern btn-primary" style="margin-top:20px" onclick="addSimItem()">+ ADICIONAR ITEM</button>
                </div>
            </div>
        </div>

        <!-- ======================= ESTOQUE ======================= -->
        <div id="stock-content" class="content-section">
            <div class="crm-header"><h2>CONTROLE DE ESTOQUE</h2><button class="btn-modern btn-primary" onclick="openStockModal()">+ NOVO INSUMO</button></div>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>ITEM</th><th>CATEGORIA</th><th>QTD ATUAL</th><th>M칈NIMO</th><th>VALOR UNIT.</th><th>TOTAL</th><th>A칂칏ES</th></tr></thead>
                    <tbody id="stock-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= CONFIGURA칂칏ES ======================= -->
        <div id="settings-content" class="content-section">
            <header><h2>CONFIGURA칂칏ES DO SISTEMA</h2></header>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>Personalizar Etapas CRM</h3>
                    <div class="settings-inputs"><input type="text" id="set-step-1" onchange="saveSettings()"><input type="text" id="set-step-2" onchange="saveSettings()"><input type="text" id="set-step-3" onchange="saveSettings()"><input type="text" id="set-step-4" onchange="saveSettings()"><input type="text" id="set-step-5" onchange="saveSettings()"></div>
                </div>
                <div class="settings-card">
                    <h3>R칩tulos do Simulador</h3>
                    <div class="settings-inputs"><input type="text" id="set-label-1" onchange="saveSettings()"><input type="text" id="set-label-2" onchange="saveSettings()"><input type="text" id="set-label-3" onchange="saveSettings()"><input type="text" id="set-label-4" onchange="saveSettings()"></div>
                </div>
                <div class="settings-card">
                    <h3>Categorias Financeiras</h3>
                    <div id="settings-categories-list" class="settings-inputs list"></div>
                    <button class="btn-modern btn-primary" onclick="addCategory()" style="width:100%; margin-top:10px;">+ NOVA CATEGORIA</button>
                </div>
                <div class="settings-card">
                    <h3>Manuten칞칚o</h3>
                    <p style="font-size:0.7rem; color:var(--text-secondary); margin-bottom:15px;">A sincroniza칞칚o com o Notion 칠 autom치tica ao salvar dados.</p>
                    <button class="btn-modern btn-danger" onclick="resetSystem()" style="width:100%"><i class="fa-solid fa-trash-can"></i> LIMPAR TODO O SISTEMA</button>
                </div>
            </div>
        </div>
    </main>

    <!-- ======================= MODAIS ======================= -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()">
        <div id="lead-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3 id="lead-modal-title">LEAD</h3><button class="close-btn" onclick="closeLeadModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Nome do Cliente</label><input type="text" id="m_cliente"></div>
                <div class="field-row">
                    <div class="field-group"><label>Empresa</label><input type="text" id="m_empresa"></div>
                    <div class="field-group"><label>Etapa Atual</label><select id="m_status"><option value="0" id="opt-step-1">1</option><option value="1" id="opt-step-2">2</option><option value="2" id="opt-step-3">3</option><option value="3" id="opt-step-4">4</option><option value="4" id="opt-step-5">5</option></select></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Origem do Lead</label><select id="m_origem"><option value="WhatsApp">WhatsApp</option><option value="Instagram">Instagram</option><option value="Indica칞칚o">Indica칞칚o</option><option value="Site">Site</option><option value="Outros">Outros</option></select></div>
                    <div class="field-group"><label>Previs칚o Entrega</label><input type="date" id="m_entrega"></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Valor Bruto (R$)</label><input type="number" id="m_valor"></div>
                    <div class="field-group"><label>Lucro Estimado (R$)</label><input type="number" id="m_lucro"></div>
                </div>
                <div class="field-group"><label>Status de Fechamento</label><div class="btn-group-modern"><button id="btn-venda" class="btn-modern" onclick="setResult('Venda')">FECHADO (VENDA)</button><button id="btn-perda" class="btn-modern" onclick="setResult('Perda')">PERDIDO (PERDA)</button></div></div>
                <input type="hidden" id="m_lead_id"><input type="hidden" id="m_resultado">
            </div>
            <div class="modal-footer"><button class="btn-modern btn-danger" id="btn-delete-lead" onclick="deleteLead()">EXCLUIR</button><div style="display:flex; gap:10px;"><button class="btn-modern" onclick="closeLeadModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveLead()">SALVAR ALTERA칂칏ES</button></div></div>
        </div>

        <div id="finance-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3 id="fin-modal-title">LAN칂AMENTO</h3><button class="close-btn" onclick="closeFinanceModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Descri칞칚o da Transa칞칚o</label><input type="text" id="f_desc"></div>
                <div class="field-row">
                    <div class="field-group"><label>Valor (R$)</label><input type="number" id="f_valor"></div>
                    <div class="field-group"><label>Categoria</label><select id="f_cat_select"></select></div>
                </div>
                <div class="field-group"><label>Data do Lan칞amento</label><input type="date" id="f_data"></div>
                <input type="hidden" id="f_tipo">
            </div>
            <div class="modal-footer"><button class="btn-modern" onclick="closeFinanceModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveTransaction()">CONFIRMAR</button></div>
        </div>

        <div id="stock-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3>ITEM DE ESTOQUE</h3><button class="close-btn" onclick="closeStockModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Nome do Insumo</label><input type="text" id="s_nome"></div>
                <div class="field-row">
                    <div class="field-group"><label>Categoria</label><input type="text" id="s_cat"></div>
                    <div class="field-group"><label>Custo Unit치rio</label><input type="number" id="s_valor"></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Quantidade</label><input type="number" id="s_qtd"></div>
                    <div class="field-group"><label>Estoque M칤nimo</label><input type="number" id="s_min"></div>
                </div>
                <input type="hidden" id="s_item_id">
            </div>
            <div class="modal-footer"><button class="btn-modern" onclick="closeStockModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveStockItem()">SALVAR ITEM</button></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
