<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Laser - Intranet</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-circle">
                <img id="main-logo-img" src="" alt="Santo Laser Logo" class="main-logo">
            </div>
            <h1 style="font-family:'Orbitron'; color:var(--neon); font-size:1.2rem; margin:0;">SANTO LASER</h1>
        </div>
        <nav>
            <a href="#" class="nav-item active" onclick="showSection('dashboard')"><i class="fa-solid fa-chart-line"></i> DASHBOARD</a>
            <a href="#" class="nav-item" onclick="showSection('crm')"><i class="fa-solid fa-users"></i> CRM</a>
            <a href="#" class="nav-item" onclick="showSection('timeline')"><i class="fa-solid fa-calendar-days"></i> TIMELINE</a>
            <a href="#" class="nav-item" onclick="showSection('calculator')"><i class="fa-solid fa-calculator"></i> CALCULADORA OS</a>
            <a href="#" class="nav-item" onclick="showSection('cashflow')"><i class="fa-solid fa-money-bill-transfer"></i> FLUXO DE CAIXA</a>
            <a href="#" class="nav-item" onclick="showSection('simulator')"><i class="fa-solid fa-bullseye"></i> SIMULADOR METAS</a>
            <a href="#" class="nav-item" onclick="showSection('stock')"><i class="fa-solid fa-boxes-stacked"></i> ESTOQUE</a>
            <a href="#" class="nav-item" onclick="showSection('settings')"><i class="fa-solid fa-gear"></i> CONFIGURA√á√ïES</a>
        </nav>
        <div class="theme-switch">
            <button id="theme-toggle" class="btn-theme" onclick="toggleTheme()">
                <i class="fa-solid fa-moon"></i> <span>MODO ESCURO</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <!-- ======================= DASHBOARD ======================= -->
        <div id="dashboard-content" class="content-section active">
            <header>
                <h2>SA√öDE DA EMPRESA</h2>
                <div class="date-display" id="current-date">--/--/----</div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <small>Faturamento (M√™s)</small>
                    <span class="value" id="dash-faturamento">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Lucro Real (M√™s)</small>
                    <span class="value" id="dash-lucro">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small id="label-pedidos-ativos">Pedidos Ativos</small>
                    <span class="value" id="dash-pedidos">0</span>
                </div>
                <div class="kpi-card">
                    <small>Convers√£o de Leads</small>
                    <span class="value" id="dash-conversao">0%</span>
                </div>
            </div>
            <div class="charts-row">
                <div class="chart-container">
                    <h3>Vendas por Origem</h3>
                    <div class="chart-wrapper">
                        <canvas id="chart-origem"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Status dos Leads</h3>
                    <div class="chart-wrapper">
                        <canvas id="chart-status"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= CRM ======================= -->
        <div id="crm-content" class="content-section">
            <div class="crm-header">
                <h2>CRM - GEST√ÉO DE OPORTUNIDADES</h2>
                <div class="crm-controls">
                    <button class="btn-modern btn-primary" onclick="openLeadModal()">+ NOVO CLIENTE</button>
                    <button class="btn-modern" onclick="toggleCRMView()"><i class="fa-solid fa-table-list"></i> ALTERNAR VIS√ÉO</button>
                </div>
            </div>

            <div id="kanban-view" class="kanban-container">
                <div class="kanban-column" id="col-1" ondrop="drop(event, 0)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-1">PASSO 1</span> <span class="count" id="count-0">0</span></div>
                    <div class="kanban-cards" id="cards-0"></div>
                </div>
                <div class="kanban-column" id="col-2" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-2">PASSO 2</span> <span class="count" id="count-1">0</span></div>
                    <div class="kanban-cards" id="cards-1"></div>
                </div>
                <div class="kanban-column" id="col-3" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-3">PASSO 3</span> <span class="count" id="count-2">0</span></div>
                    <div class="kanban-cards" id="cards-2"></div>
                </div>
                <div class="kanban-column" id="col-4" ondrop="drop(event, 3)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-4">PASSO 4</span> <span class="count" id="count-3">0</span></div>
                    <div class="kanban-cards" id="cards-3"></div>
                </div>
                <div class="kanban-column" id="col-5" ondrop="drop(event, 4)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-5">PASSO 5</span> <span class="count" id="count-4">0</span></div>
                    <div class="kanban-cards" id="cards-4"></div>
                </div>
            </div>

            <div id="table-view" class="table-container" style="display: none;">
                <table class="crm-table">
                    <thead>
                        <tr>
                            <th>CLIENTE</th>
                            <th>EMPRESA</th>
                            <th>STATUS</th>
                            <th>VALOR</th>
                            <th>ENTREGA</th>
                            <th>A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= TIMELINE ======================= -->
        <div id="timeline-content" class="content-section">
            <header>
                <h2>LINHA DO TEMPO DE PROJETOS</h2>
            </header>
            <div class="timeline-container" id="timeline-wrapper">
                <!-- Preenchido via JS -->
            </div>
        </div>

        <!-- ======================= CALCULADORA ======================= -->
        <div id="calculator-content" class="content-section">
            <div class="calc-main-layout">
                <div class="calc-form-side">
                    <div class="section-header">‚öôÔ∏è Configura√ß√µes Globais</div>
                    <div class="field-row">
                        <div class="field-group">
                            <label id="label-valor-hora">Valor da Hora (R$)</label>
                            <input type="number" id="g_valor_hora" value="100" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label id="label-imposto">Imposto (%)</label>
                            <input type="number" id="g_imposto" value="6" oninput="calc()">
                        </div>
                    </div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Taxa Cart√£o (%)</label>
                            <input type="number" id="g_cartao" value="5" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label>Frete Insumos (R$)</label>
                            <input type="number" id="g_frete" value="0" oninput="calc()">
                        </div>
                    </div>
                    
                    <div class="section-header">üë§ Dados do Cliente</div>
                    <div class="field-group">
                        <label>Nome do Cliente</label>
                        <input type="text" id="g_cliente" placeholder="Nome Completo" oninput="calc()">
                    </div>
                    <div class="field-group">
                        <label>Data da Proposta</label>
                        <input type="date" id="g_data_proposta" oninput="calc()">
                    </div>

                    <div class="section-header">üíé Itens do Or√ßamento</div>
                    <div id="items-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addItem()">+ ADICIONAR ITEM</button>
                    
                    <div class="section-header">üöö Frete e Desconto</div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Frete Cliente (R$)</label>
                            <input type="number" id="g_frete_cliente" value="0" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label>Desconto (%)</label>
                            <input type="number" id="g_desconto" value="0" oninput="calc()">
                        </div>
                    </div>
                </div>

                <div class="calc-preview-side">
                    <div class="quote-card" id="quote-to-print">
                        <div class="quote-header">
                            <img id="quote-logo-img" src="" alt="Logo" style="height:50px">
                            <div style="text-align:right">
                                <h2 style="margin:0; color:var(--neon); font-family:'Orbitron'">OR√áAMENTO</h2>
                                <small id="display_data_proposta"></small>
                            </div>
                        </div>
                        <div class="client-info">
                            <strong>CLIENTE:</strong> <span id="display_nome_cliente"></span>
                        </div>
                        <table class="items-table">
                            <thead><tr><th>QTD</th><th>DESCRI√á√ÉO</th><th>TOTAL</th></tr></thead>
                            <tbody id="card-body"></tbody>
                        </table>
                        <div class="totals-area">
                            <div class="total-row main"><span>TOTAL FINAL</span><span id="card_total">R$ 0,00</span></div>
                        </div>
                        <div class="footer-info">
                            SANTO LASER - CNPJ: 64.544.332/0001-10 | (48) 99672-8584
                        </div>
                    </div>
                    <div class="calc-actions">
                        <button class="btn-modern btn-primary" onclick="copyWA()"><i class="fa-brands fa-whatsapp"></i> WHATSAPP</button>
                        <button class="btn-modern btn-success" onclick="sendToCRM()"><i class="fa-solid fa-cloud-arrow-up"></i> SALVAR NO CRM</button>
                        <button class="btn-modern" onclick="window.print()"><i class="fa-solid fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= FLUXO DE CAIXA ======================= -->
        <div id="cashflow-content" class="content-section">
            <div class="crm-header">
                <h2>FLUXO DE CAIXA</h2>
                <div class="cashflow-controls">
                    <button class="btn-modern" onclick="openInitialBalanceModal()">AJUSTAR SALDO</button>
                    <button class="btn-modern btn-primary" onclick="openFinanceModal('Entrada')">+ ENTRADA</button>
                    <button class="btn-modern btn-danger" onclick="openFinanceModal('Sa√≠da')">- SA√çDA</button>
                </div>
            </div>
            
            <div class="finance-kpis">
                <div class="kpi-card">
                    <small>Saldo Atual</small>
                    <span class="value" id="fin-saldo">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Total Entradas</small>
                    <span class="value" id="fin-entradas" style="color:var(--success)">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Total Sa√≠das</small>
                    <span class="value" id="fin-saidas" style="color:var(--danger)">R$ 0,00</span>
                </div>
            </div>

            <div class="filter-bar">
                <div class="filter-group">
                    <label>Per√≠odo</label>
                    <input type="date" id="filter-start" onchange="renderFinance()">
                    <span>at√©</span>
                    <input type="date" id="filter-end" onchange="renderFinance()">
                </div>
                <div class="filter-group">
                    <label>Tipo</label>
                    <select id="filter-type" onchange="renderFinance()">
                        <option value="">Todos</option>
                        <option value="Entrada">Entrada</option>
                        <option value="Sa√≠da">Sa√≠da</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Categoria</label>
                    <select id="filter-cat" onchange="renderFinance()">
                        <option value="">Todas</option>
                    </select>
                </div>
                <button class="btn-modern" onclick="clearFinanceFilters()">LIMPAR</button>
            </div>

            <div class="table-container">
                <table class="crm-table">
                    <thead>
                        <tr>
                            <th>DATA</th>
                            <th>DESCRI√á√ÉO</th>
                            <th>TIPO</th>
                            <th>CATEGORIA</th>
                            <th>VALOR</th>
                            <th>A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="finance-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= SIMULADOR METAS ======================= -->
        <div id="simulator-content" class="content-section">
            <header>
                <h2>SIMULADOR DE METAS FINANCEIRAS</h2>
            </header>
            <div class="simulator-layout">
                <div class="sim-sidebar">
                    <div class="section-header">üéØ Metas Desejadas</div>
                    <div class="field-group">
                        <label id="label-prolabore">Pr√≥-labore (R$)</label>
                        <input type="number" id="sim-prolabore" value="2500" oninput="runSimulator()">
                    </div>
                    <div class="field-group">
                        <label id="label-custos-fixos">Custos Fixos (R$)</label>
                        <input type="number" id="sim-fixos" value="1000" oninput="runSimulator()">
                    </div>
                    <div class="field-group">
                        <label id="label-marketing">Marketing (R$)</label>
                        <input type="number" id="sim-marketing" value="200" oninput="runSimulator()">
                    </div>
                    <div class="field-group">
                        <label id="label-reserva">Reserva/Investimento (R$)</label>
                        <input type="number" id="sim-reserva" value="500" oninput="runSimulator()">
                    </div>
                    <div class="sim-total-meta">
                        <small>META DE LUCRO TOTAL</small>
                        <h2 id="sim-meta-total">R$ 4.200,00</h2>
                    </div>
                </div>
                <div class="sim-main">
                    <div class="section-header">üìä Planejamento de Produtos/Servi√ßos</div>
                    <div class="table-container">
                        <table class="crm-table">
                            <thead>
                                <tr>
                                    <th>NOME</th>
                                    <th>PRE√áO VENDA</th>
                                    <th>MARGEM (%)</th>
                                    <th>VENDAS ATUAIS</th>
                                    <th>VENDAS NECESS√ÅRIAS</th>
                                    <th>A√á√ïES</th>
                                </tr>
                            </thead>
                            <tbody id="sim-table-body"></tbody>
                        </table>
                    </div>
                    <button class="btn-modern btn-primary" style="margin-top:20px" onclick="addSimItem()">+ ADICIONAR PRODUTO</button>
                </div>
            </div>
        </div>

        <!-- ======================= ESTOQUE ======================= -->
        <div id="stock-content" class="content-section">
            <div class="crm-header">
                <h2>CONTROLE DE ESTOQUE</h2>
                <button class="btn-modern btn-primary" onclick="openStockModal()">+ NOVO ITEM</button>
            </div>
            <div class="table-container">
                <table class="crm-table">
                    <thead>
                        <tr>
                            <th>ITEM</th>
                            <th>CATEGORIA</th>
                            <th>QTD ATUAL</th>
                            <th>M√çNIMO</th>
                            <th>VALOR UNIT.</th>
                            <th>TOTAL</th>
                            <th>A√á√ïES</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- ======================= CONFIGURA√á√ïES ======================= -->
        <div id="settings-content" class="content-section">
            <header>
                <h2>CONFIGURA√á√ïES DO SISTEMA</h2>
            </header>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>Personalizar Etapas do CRM</h3>
                    <div class="field-group"><label>Etapa 1</label><input type="text" id="set-step-1" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Etapa 2</label><input type="text" id="set-step-2" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Etapa 3</label><input type="text" id="set-step-3" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Etapa 4</label><input type="text" id="set-step-4" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Etapa 5</label><input type="text" id="set-step-5" onchange="saveSettings()"></div>
                </div>
                <div class="settings-card">
                    <h3>R√≥tulos do Simulador</h3>
                    <div class="field-group"><label>Campo 1</label><input type="text" id="set-label-1" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Campo 2</label><input type="text" id="set-label-2" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Campo 3</label><input type="text" id="set-label-3" onchange="saveSettings()"></div>
                    <div class="field-group"><label>Campo 4</label><input type="text" id="set-label-4" onchange="saveSettings()"></div>
                </div>
                <div class="settings-card">
                    <h3>Categorias Financeiras</h3>
                    <div id="settings-categories-list"></div>
                    <button class="btn-modern btn-primary" onclick="addCategory()">+ ADICIONAR CATEGORIA</button>
                </div>
                <div class="settings-card">
                    <h3>Backup e Dados</h3>
                    <button class="btn-modern btn-danger" onclick="resetSystem()"><i class="fa-solid fa-triangle-exclamation"></i> RESETAR TODOS OS DADOS</button>
                </div>
            </div>
        </div>
    </main>

    <!-- ======================= MODAIS ======================= -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()">
        <!-- Modal CRM -->
        <div id="lead-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="lead-modal-title">NOVO CLIENTE</h3>
                <button class="close-btn" onclick="closeLeadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="field-group">
                    <label>Nome do Cliente</label>
                    <input type="text" id="m_cliente" placeholder="Ex: Jo√£o Silva">
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Empresa</label>
                        <input type="text" id="m_empresa" placeholder="Opcional">
                    </div>
                    <div class="field-group">
                        <label>Status Atual</label>
                        <select id="m_status">
                            <option value="0" id="opt-step-1">Passo 1</option>
                            <option value="1" id="opt-step-2">Passo 2</option>
                            <option value="2" id="opt-step-3">Passo 3</option>
                            <option value="3" id="opt-step-4">Passo 4</option>
                            <option value="4" id="opt-step-5">Passo 5</option>
                        </select>
                    </div>
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Origem</label>
                        <select id="m_origem">
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="Instagram">Instagram</option>
                            <option value="Indica√ß√£o">Indica√ß√£o</option>
                            <option value="Site">Site</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="field-group">
                        <label>Data Entrega</label>
                        <input type="date" id="m_entrega">
                    </div>
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Valor Total (R$)</label>
                        <input type="number" id="m_valor" placeholder="0.00">
                    </div>
                    <div class="field-group">
                        <label>Lucro Real (R$)</label>
                        <input type="number" id="m_lucro" placeholder="0.00">
                    </div>
                </div>
                <div class="field-group">
                    <label>Resultado do Neg√≥cio</label>
                    <div class="btn-group-modern">
                        <button id="btn-venda" class="btn-modern" onclick="setResult('Venda')"><i class="fa-solid fa-check"></i> VENDA</button>
                        <button id="btn-perda" class="btn-modern" onclick="setResult('Perda')"><i class="fa-solid fa-xmark"></i> PERDA</button>
                    </div>
                </div>
                <input type="hidden" id="m_lead_id">
                <input type="hidden" id="m_resultado">
            </div>
            <div class="modal-footer" style="justify-content: space-between;">
                <button class="btn-modern btn-danger" id="btn-delete-lead" onclick="deleteLead()"><i class="fa-solid fa-trash"></i> EXCLUIR</button>
                <div style="display:flex; gap:12px;">
                    <button class="btn-modern" onclick="closeLeadModal()">CANCELAR</button>
                    <button class="btn-modern btn-primary" onclick="saveLead()">SALVAR</button>
                </div>
            </div>
        </div>

        <!-- Modal Financeiro -->
        <div id="finance-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="fin-modal-title">NOVA TRANSA√á√ÉO</h3>
                <button class="close-btn" onclick="closeFinanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="field-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="f_desc" placeholder="Ex: Compra de Acr√≠lico">
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Valor (R$)</label>
                        <input type="number" id="f_valor" placeholder="0.00">
                    </div>
                    <div class="field-group">
                        <label>Categoria</label>
                        <select id="f_cat_select"></select>
                    </div>
                </div>
                <div class="field-group">
                    <label>Data</label>
                    <input type="date" id="f_data">
                </div>
                <input type="hidden" id="f_tipo">
            </div>
            <div class="modal-footer">
                <button class="btn-modern" onclick="closeFinanceModal()">CANCELAR</button>
                <button class="btn-modern btn-primary" onclick="saveTransaction()">SALVAR</button>
            </div>
        </div>

        <!-- Modal Estoque -->
        <div id="stock-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="stock-modal-title">ITEM DE ESTOQUE</h3>
                <button class="close-btn" onclick="closeStockModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="field-group">
                    <label>Nome do Item</label>
                    <input type="text" id="s_nome" placeholder="Ex: Chapa Acr√≠lico 3mm">
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Categoria</label>
                        <input type="text" id="s_cat" placeholder="Ex: Chapas">
                    </div>
                    <div class="field-group">
                        <label>Valor Unit√°rio (R$)</label>
                        <input type="number" id="s_valor" placeholder="0.00">
                    </div>
                </div>
                <div class="field-row">
                    <div class="field-group">
                        <label>Quantidade Atual</label>
                        <input type="number" id="s_qtd" placeholder="0">
                    </div>
                    <div class="field-group">
                        <label>Estoque M√≠nimo</label>
                        <input type="number" id="s_min" placeholder="0">
                    </div>
                </div>
                <input type="hidden" id="s_item_id">
            </div>
            <div class="modal-footer">
                <button class="btn-modern" onclick="closeStockModal()">CANCELAR</button>
                <button class="btn-modern btn-primary" onclick="saveStockItem()">SALVAR</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
