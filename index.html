<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Laser - BI & ERP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-circle">
                <img id="main-logo-img" src="" alt="Santo Laser Logo" class="main-logo">
            </div>
            <h1 class="sidebar-title">SANTO LASER</h1>
        </div>
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="global-search" placeholder="Buscar cliente..." oninput="globalSearch()">
        </div>
        <nav>
            <a href="#" class="nav-item active" onclick="showSection('dashboard')"><i class="fa-solid fa-chart-line"></i> DASHBOARD</a>
            <a href="#" class="nav-item" onclick="showSection('crm')"><i class="fa-solid fa-users"></i> CRM</a>
            <a href="#" class="nav-item" onclick="showSection('calculator')"><i class="fa-solid fa-calculator"></i> CALCULADORA OS</a>
            <a href="#" class="nav-item" onclick="showSection('cashflow')"><i class="fa-solid fa-money-bill-transfer"></i> FLUXO DE CAIXA</a>
            <a href="#" class="nav-item" onclick="showSection('dre')"><i class="fa-solid fa-file-invoice-dollar"></i> DRE</a>
            <a href="#" class="nav-item" onclick="showSection('simulator')"><i class="fa-solid fa-bullseye"></i> SIMULADOR METAS</a>
            <a href="#" class="nav-item" onclick="showSection('stock')"><i class="fa-solid fa-boxes-stacked"></i> ESTOQUE</a>
            <a href="#" class="nav-item" onclick="showSection('settings')"><i class="fa-solid fa-gear"></i> CONFIGURA√á√ïES</a>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-modern" style="width:100%; margin-bottom:10px;" onclick="exportToExcel()"><i class="fa-solid fa-file-excel"></i> EXPORTAR EXCEL</button>
            <div class="theme-switch">
                <button id="theme-toggle" class="btn-theme" onclick="toggleTheme()">
                    <i class="fa-solid fa-moon"></i> <span>MODO ESCURO</span>
                </button>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard-content" class="content-section active">
            <header>
                <h2>INTELIG√äNCIA DE NEG√ìCIO</h2>
                <div class="filter-bar">
                    <input type="month" id="dash-month-filter" onchange="updateDashboard()">
                </div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card highlight-neon">
                    <small>Faturamento (Vendas)</small>
                    <span class="value" id="dash-faturamento">R$ 0,00</span>
                    <div class="kpi-trend" id="dash-faturamento-trend">Previs√£o: R$ 0,00</div>
                </div>
                <div class="kpi-card">
                    <small>Lucro L√≠quido Real</small>
                    <span class="value" id="dash-lucro-real">R$ 0,00</span>
                    <div class="kpi-trend" id="dash-lucro-margem">Margem: 0%</div>
                </div>
                <div class="kpi-card">
                    <small>Pipeline (Oportunidades)</small>
                    <span class="value" id="dash-pipeline">R$ 0,00</span>
                    <div class="kpi-trend">Em negocia√ß√£o</div>
                </div>
                <div class="kpi-card">
                    <small>Pedidos em Produ√ß√£o</small>
                    <span class="value" id="dash-pedidos">0</span>
                    <div class="kpi-trend" id="dash-pedidos-valor">R$ 0,00</div>
                </div>
            </div>
            <div class="charts-row">
                <div class="chart-container">
                    <h3>Fluxo de Caixa Mensal</h3>
                    <div class="chart-wrapper"><canvas id="chart-performance"></canvas></div>
                </div>
                <div class="chart-container">
                    <h3>Previsibilidade de Receita</h3>
                    <div class="chart-wrapper"><canvas id="chart-previsibilidade"></canvas></div>
                </div>
            </div>
            <div class="dashboard-bottom-row">
                <div class="chart-container timeline-widget">
                    <h3>Cronograma de Entregas</h3>
                    <div id="timeline-wrapper" class="timeline-container"></div>
                </div>
                <div class="chart-container">
                    <h3>Origem de Leads</h3>
                    <div class="chart-wrapper"><canvas id="chart-origem"></canvas></div>
                </div>
            </div>
        </div>

        <!-- CRM -->
        <div id="crm-content" class="content-section">
            <div class="crm-header">
                <h2>GEST√ÉO DE OPORTUNIDADES</h2>
                <div class="crm-controls">
                    <button class="btn-modern btn-primary" onclick="openLeadModal()">+ NOVO CLIENTE</button>
                    <button class="btn-modern" onclick="toggleCRMView()"><i class="fa-solid fa-table-list"></i> ALTERNAR VIS√ÉO</button>
                </div>
            </div>
            <div id="kanban-view" class="kanban-container">
                <div class="kanban-column" id="col-0" ondrop="drop(event, 0)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-1">PROPOSTA</span> <span class="count" id="count-0">0</span></div>
                    <div class="kanban-cards" id="cards-0"></div>
                </div>
                <div class="kanban-column" id="col-1" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-2">APROVADO</span> <span class="count" id="count-1">0</span></div>
                    <div class="kanban-cards" id="cards-1"></div>
                </div>
                <div class="kanban-column" id="col-2" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-3">PRODU√á√ÉO</span> <span class="count" id="count-2">0</span></div>
                    <div class="kanban-cards" id="cards-2"></div>
                </div>
                <div class="kanban-column" id="col-3" ondrop="drop(event, 3)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-4">FINALIZADO</span> <span class="count" id="count-3">0</span></div>
                    <div class="kanban-cards" id="cards-3"></div>
                </div>
                <div class="kanban-column" id="col-4" ondrop="drop(event, 4)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-5">PAGO</span> <span class="count" id="count-4">0</span></div>
                    <div class="kanban-cards" id="cards-4"></div>
                </div>
            </div>
            <div id="table-view" class="table-container" style="display: none;">
                <table class="modern-table">
                    <thead><tr><th>CLIENTE</th><th>EMPRESA</th><th>STATUS</th><th>VALOR</th><th>ENTREGA</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- CALCULADORA -->
        <div id="calculator-content" class="content-section">
            <div class="calc-main-layout">
                <div class="calc-form-side">
                    <div class="section-header">üîó V√≠nculo de Intelig√™ncia</div>
                    <div class="field-group">
                        <label>Vincular a Lead Existente?</label>
                        <select id="g_vincular_lead" onchange="loadLeadDataIntoCalc()">
                            <option value="">-- Criar Novo Lead --</option>
                        </select>
                    </div>
                    <div class="section-header">‚öôÔ∏è Par√¢metros Globais</div>
                    <div class="field-row">
                        <div class="field-group"><label>Valor Hora (R$)</label><input type="number" id="g_valor_hora" value="100" oninput="calc()"></div>
                        <div class="field-group"><label>Markup (x)</label><input type="number" id="g_markup" value="2.5" step="0.1" oninput="calc()"></div>
                    </div>
                    <div class="field-row">
                        <div class="field-group"><label>Imposto (%)</label><input type="number" id="g_imposto" value="6" oninput="calc()"></div>
                        <div class="field-group"><label>Taxa Cart√£o (%)</label><input type="number" id="g_cartao" value="5" oninput="calc()"></div>
                    </div>
                    <div class="section-header">üë§ Dados do Cliente</div>
                    <div class="field-group"><label>Nome do Cliente</label><input type="text" id="g_cliente" placeholder="Nome Completo" oninput="calc()"></div>
                    <div class="field-row">
                        <div class="field-group"><label>Empresa</label><input type="text" id="g_empresa_calc" placeholder="Opcional" oninput="calc()"></div>
                        <div class="field-group"><label>WhatsApp</label><input type="text" id="g_whatsapp" placeholder="Ex: 47999999999" oninput="calc()"></div>
                    </div>
                    <div class="field-group"><label>Data da Proposta</label><input type="date" id="g_data_proposta" oninput="calc()"></div>
                    
                    <div class="section-header">üíé Itens do Or√ßamento</div>
                    <div id="items-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addItem()">+ ADICIONAR ITEM</button>
                    
                    <div class="section-header">üöö Log√≠stica e Descontos</div>
                    <div class="field-row">
                        <div class="field-group"><label>Frete Cliente (R$)</label><input type="number" id="g_frete_cliente" value="0" oninput="calc()"></div>
                        <div class="field-group"><label>Desconto (%)</label><input type="number" id="g_desconto" value="0" oninput="calc()"></div>
                    </div>

                    <div class="section-header">üìä Resumo de Produ√ß√£o</div>
                    <div class="intel-grid">
                        <div class="intel-item"><span>Minutos Totais:</span> <strong id="intel-minutos">0</strong></div>
                        <div class="intel-item"><span>Custo de Tempo:</span> <strong id="intel-custo-tempo">R$ 0,00</strong></div>
                        <div class="intel-item"><span>Custo Material:</span> <strong id="intel-custo-mat">R$ 0,00</strong></div>
                        <div class="intel-item"><span>Custo Geral:</span> <strong id="intel-custo-geral">R$ 0,00</strong></div>
                    </div>
                </div>

                <div class="calc-preview-side">
                    <div class="quote-card-container">
                        <div class="quote-card" id="quote-card">
                            <div class="quote-header">
                                <div class="quote-meta">
                                    <h2>OR√áAMENTO</h2>
                                    <p id="display_data_proposta"></p>
                                </div>
                                <div class="quote-status">SANTO LASER</div>
                            </div>
                            <div class="quote-client-box">
                                <strong>CLIENTE:</strong> <span id="display_nome_cliente"></span><br>
                                <span id="display_empresa_cliente" style="font-size: 0.65rem; opacity: 0.8;"></span>
                            </div>
                            <table class="quote-table">
                                <thead><tr><th>QTD</th><th>DESCRI√á√ÉO</th><th>TOTAL</th></tr></thead>
                                <tbody id="card-body"></tbody>
                            </table>
                            <div class="quote-footer">
                                <div class="quote-total-row">
                                    <span>VALOR TOTAL</span>
                                    <h3 id="card_total">R$ 0,00</h3>
                                </div>
                                <div class="quote-disclaimer">
                                    * Or√ßamento v√°lido por 7 dias. Pagamento via PIX ou Cart√£o.<br>
                                    <span id="display_whatsapp_link"></span><br>
                                    <span style="font-size: 0.7rem; opacity: 0.6; display: block; margin-top: 10px;">CNPJ: 00.000.000/0001-00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="calc-actions">
                        <button class="btn-modern btn-success" style="flex:1" onclick="sendToCRM()">SALVAR NO CRM & NOTION</button>
                        <button class="btn-modern" style="flex:1" onclick="copyWA()">COPIAR WHATSAPP</button>
                    </div>
                    <div class="intel-box" style="margin-top:20px;">
                        <h4>Intelig√™ncia de Custos</h4>
                        <div class="intel-grid">
                            <div class="intel-item"><span>Impostos Totais:</span> <strong id="intel-impostos">R$ 0,00</strong></div>
                            <div class="intel-item"><span>CPV (Custo):</span> <strong id="intel-cpv">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Lucro Real Estimado:</span> <strong id="intel-lucro" style="color:var(--success)">R$ 0,00</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FLUXO DE CAIXA -->
        <div id="cashflow-content" class="content-section">
            <header>
                <h2>FLUXO DE CAIXA</h2>
                <div class="finance-actions">
                    <button class="btn-modern btn-primary" onclick="openFinanceModal('Entrada')">+ ENTRADA</button>
                    <button class="btn-modern btn-danger" onclick="openFinanceModal('Sa√≠da')">- SA√çDA</button>
                    <button class="btn-modern" onclick="openInitialBalanceModal()">AJUSTAR SALDO</button>
                </div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <small>Saldo Atual (Conta)</small>
                    <span class="value" id="fin-saldo">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Entradas (M√™s)</small>
                    <span class="value" id="fin-entradas" style="color:var(--success)">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Sa√≠das (M√™s)</small>
                    <span class="value" id="fin-saidas" style="color:var(--danger)">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>Resultado L√≠quido</small>
                    <span class="value" id="fin-resultado">R$ 0,00</span>
                </div>
            </div>
            <div class="finance-filters">
                <div class="field-group"><label>In√≠cio</label><input type="date" id="filter-start" onchange="renderFinance()"></div>
                <div class="field-group"><label>Fim</label><input type="date" id="filter-end" onchange="renderFinance()"></div>
                <div class="field-group">
                    <label>Tipo</label>
                    <select id="filter-type" onchange="renderFinance()">
                        <option value="">Todos</option>
                        <option value="Entrada">Entrada</option>
                        <option value="Sa√≠da">Sa√≠da</option>
                    </select>
                </div>
                <div class="field-group">
                    <label>Categoria</label>
                    <select id="filter-cat" onchange="renderFinance()">
                        <option value="">Todas</option>
                    </select>
                </div>
                <button class="btn-modern" onclick="clearFinanceFilters()">LIMPAR</button>
            </div>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>DATA</th><th>DESCRI√á√ÉO</th><th>TIPO</th><th>CATEGORIA</th><th>VALOR</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="finance-table-body"></tbody>
                </table>
            </div>
            <div class="finance-splits">
                <div class="split-card"><span>Reserva Seguran√ßa (10%):</span> <strong id="fin-reserva">R$ 0,00</strong></div>
                <div class="split-card"><span>Provis√£o Impostos:</span> <strong id="fin-impostos">R$ 0,00</strong></div>
                <div class="split-card"><span>Lucro Real Acumulado:</span> <strong id="fin-lucro">R$ 0,00</strong></div>
            </div>
        </div>

        <!-- DRE -->
        <div id="dre-content" class="content-section">
            <header>
                <h2>DEMONSTRATIVO DE RESULTADOS (DRE)</h2>
                <div class="filter-bar"><input type="month" id="dre-month-filter" onchange="renderDRE()"></div>
            </header>
            <div class="table-container">
                <table class="modern-table dre-table">
                    <thead><tr><th>DESCRI√á√ÉO</th><th>VALOR (R$)</th><th>% RECEITA</th></tr></thead>
                    <tbody>
                        <tr class="dre-row-main"><td>RECEITA BRUTA (Vendas Pagas)</td><td id="dre-receita-bruta">R$ 0,00</td><td>100%</td></tr>
                        <tr><td>(-) Impostos e Taxas</td><td id="dre-impostos">R$ 0,00</td><td id="dre-impostos-p">0%</td></tr>
                        <tr class="dre-row-sub"><td>RECEITA L√çQUIDA</td><td id="dre-receita-liquida">R$ 0,00</td><td id="dre-receita-liquida-p">0%</td></tr>
                        <tr><td>(-) Custo de Produ√ß√£o (CPV)</td><td id="dre-cpv">R$ 0,00</td><td id="dre-cpv-p">0%</td></tr>
                        <tr class="dre-row-sub"><td>LUCRO BRUTO</td><td id="dre-lucro-bruto">R$ 0,00</td><td id="dre-lucro-bruto-p">0%</td></tr>
                        <tr><td>(-) Despesas Operacionais (Sa√≠das)</td><td id="dre-despesas">R$ 0,00</td><td id="dre-despesas-p">0%</td></tr>
                        <tr class="dre-row-final"><td>RESULTADO L√çQUIDO DO PER√çODO</td><td id="dre-resultado">R$ 0,00</td><td id="dre-resultado-p">0%</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- SIMULADOR METAS -->
        <div id="simulator-content" class="content-section">
            <header><h2>SIMULADOR DE METAS FINANCEIRAS</h2></header>
            <div class="sim-layout">
                <div class="sim-sidebar">
                    <h3>üéØ Metas Desejadas</h3>
                    <div id="sim-dynamic-labels"></div>
                    <div class="sim-meta-card">
                        <small>META DE LUCRO TOTAL</small>
                        <h2 id="sim-meta-total">R$ 0,00</h2>
                    </div>
                </div>
                <div class="sim-main">
                    <h3>üìä Planejamento de Produtos/Servi√ßos</h3>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead><tr><th>NOME</th><th>PRE√áO VENDA</th><th>MARGEM (%)</th><th>VENDAS ATUAIS</th><th>VENDAS NECESS√ÅRIAS</th><th>A√á√ïES</th></tr></thead>
                            <tbody id="sim-table-body"></tbody>
                        </table>
                    </div>
                    <button class="btn-modern btn-primary" style="margin-top:20px;" onclick="addSimItem()">+ ADICIONAR PRODUTO</button>
                </div>
            </div>
        </div>

        <!-- ESTOQUE -->
        <div id="stock-content" class="content-section">
            <header>
                <h2>CONTROLE DE ESTOQUE</h2>
                <button class="btn-modern btn-primary" onclick="openStockModal()">+ NOVO ITEM</button>
            </header>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>ITEM</th><th>CATEGORIA</th><th>QTD ATUAL</th><th>M√çNIMO</th><th>VALOR UNIT.</th><th>VALOR TOTAL</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="stock-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- CONFIGURA√á√ïES -->
        <div id="settings-content" class="content-section">
            <header><h2>CONFIGURA√á√ïES DO SISTEMA</h2></header>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>Personalizar Etapas do CRM</h3>
                    <div id="settings-crm-steps"></div>
                </div>
                <div class="settings-card">
                    <h3>R√≥tulos do Simulador</h3>
                    <div id="settings-sim-labels"></div>
                    <button class="btn-modern btn-primary" onclick="addSimLabel()">+ NOVO R√ìTULO</button>
                </div>
                <div class="settings-card">
                    <h3>Categorias Financeiras</h3>
                    <div id="settings-finance-cats"></div>
                    <button class="btn-modern btn-primary" onclick="addFinanceCat()">+ NOVA CATEGORIA</button>
                </div>
            </div>
            <button class="btn-modern btn-success" style="margin-top:30px; width:200px;" onclick="saveSettings()">SALVAR CONFIGURA√á√ïES</button>
        </div>
    </main>

    <!-- MODAIS -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()"></div>

    <!-- MODAL CRM -->
    <div id="lead-modal" class="modal-modern">
        <h3 id="lead-modal-title">NOVO CLIENTE</h3>
        <input type="hidden" id="l_id">
        <div class="field-group"><label>Nome do Cliente</label><input type="text" id="l_cliente"></div>
        <div class="field-group"><label>Empresa</label><input type="text" id="l_empresa"></div>
        <div class="field-row">
            <div class="field-group"><label>Valor (R$)</label><input type="number" id="l_valor"></div>
            <div class="field-group"><label>Data Entrega</label><input type="date" id="l_entrega"></div>
        </div>
        <div class="field-row">
            <div class="field-group">
                <label>Status</label>
                <select id="l_status"></select>
            </div>
            <div class="field-group">
                <label>Origem</label>
                <select id="l_origem">
                    <option>WhatsApp</option><option>Instagram</option><option>Indica√ß√£o</option><option>Site</option><option>Outros</option>
                </select>
            </div>
        </div>
        <div class="intel-box" id="lead-intel-box" style="display:none; margin-top:15px;">
            <h4>Intelig√™ncia de Custos</h4>
            <div class="intel-grid">
                <div class="intel-item"><span>Impostos:</span> <strong id="l_intel_impostos">R$ 0,00</strong></div>
                <div class="intel-item"><span>CPV:</span> <strong id="l_intel_cpv">R$ 0,00</strong></div>
                <div class="intel-item"><span>Lucro:</span> <strong id="l_intel_lucro">R$ 0,00</strong></div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-modern btn-success" id="btn-win" onclick="setLeadResult('Venda')">MARCAR VENDA</button>
            <button class="btn-modern btn-danger" id="btn-loss" onclick="setLeadResult('Perda')">MARCAR PERDA</button>
            <button class="btn-modern btn-primary" onclick="saveLead()">SALVAR</button>
            <button class="btn-modern btn-danger" onclick="deleteLead()">EXCLUIR</button>
            <button class="btn-modern" onclick="closeAllModals()">CANCELAR</button>
        </div>
    </div>

    <!-- MODAL FINANCEIRO -->
    <div id="finance-modal" class="modal-modern">
        <h3 id="fin-modal-title">NOVA TRANSA√á√ÉO</h3>
        <input type="hidden" id="f_tipo">
        <div class="field-group"><label>Descri√ß√£o</label><input type="text" id="f_desc"></div>
        <div class="field-row">
            <div class="field-group"><label>Valor (R$)</label><input type="number" id="f_valor"></div>
            <div class="field-group"><label>Data</label><input type="date" id="f_data"></div>
        </div>
        <div class="field-group">
            <label>Categoria</label>
            <select id="f_cat_select"></select>
        </div>
        <div class="modal-actions">
            <button class="btn-modern btn-primary" onclick="saveTransaction()">SALVAR</button>
            <button class="btn-modern" onclick="closeAllModals()">CANCELAR</button>
        </div>
    </div>

    <!-- MODAL ESTOQUE -->
    <div id="stock-modal" class="modal-modern">
        <h3>GERENCIAR ITEM ESTOQUE</h3>
        <input type="hidden" id="s_id">
        <div class="field-group"><label>Nome do Item</label><input type="text" id="s_nome"></div>
        <div class="field-group"><label>Categoria</label><input type="text" id="s_cat"></div>
        <div class="field-row">
            <div class="field-group"><label>Qtd Atual</label><input type="number" id="s_qtd"></div>
            <div class="field-group"><label>Qtd M√≠nima</label><input type="number" id="s_min"></div>
        </div>
        <div class="field-group"><label>Valor Unit√°rio (Custo)</label><input type="number" id="s_valor"></div>
        <div class="modal-actions">
            <button class="btn-modern btn-primary" onclick="saveStockItem()">SALVAR</button>
            <button class="btn-modern" onclick="closeAllModals()">CANCELAR</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
