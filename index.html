<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Laser - Intranet Master</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="sidebar">
        <div class="logo-container">
            <div class="logo-circle" id="logo-circle-container">
                <!-- Logo Base64 será inserida aqui via JS -->
            </div>
            <h1 class="sidebar-title">SANTO LASER</h1>
        </div>

        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="global-search" placeholder="Buscar cliente..." oninput="globalSearch(this.value)">
        </div>

        <ul class="nav-links">
            <li class="nav-item active" data-section="dashboard"><i class="fas fa-chart-line"></i> DASHBOARD</li>
            <li class="nav-item" data-section="crm"><i class="fas fa-users"></i> CRM</li>
            <li class="nav-item" data-section="calculator"><i class="fas fa-calculator"></i> CALCULADORA OS</li>
            <li class="nav-item" data-section="cashflow"><i class="fas fa-money-bill-wave"></i> FLUXO DE CAIXA</li>
            <li class="nav-item" data-section="dre"><i class="fas fa-file-invoice-dollar"></i> DRE</li>
            <li class="nav-item" data-section="goals"><i class="fas fa-bullseye"></i> SIMULADOR METAS</li>
            <li class="nav-item" data-section="inventory"><i class="fas fa-boxes"></i> ESTOQUE</li>
            <li class="nav-item" data-section="settings"><i class="fas fa-cog"></i> CONFIGURAÇÕES</li>
        </ul>

        <div class="sidebar-footer">
            <button class="btn-modern btn-primary" id="theme-toggle" style="width: 100%; margin-bottom: 10px;">
                <i class="fas fa-adjust"></i> ALTERAR TEMA
            </button>
            <button class="btn-modern btn-success" onclick="exportToExcel()" style="width: 100%;">
                <i class="fas fa-file-excel"></i> EXPORTAR EXCEL
            </button>
        </div>
    </nav>

    <main class="main-content">
        <!-- DASHBOARD -->
        <section id="dashboard" class="content-section active">
            <header>
                <h2>DASHBOARD DE SAÚDE</h2>
                <div class="header-filters">
                    <input type="month" id="dash-month-filter" onchange="updateDashboard()">
                </div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card highlight-neon">
                    <small>FATURAMENTO (VENDAS PAGAS)</small>
                    <span class="value" id="dash-revenue">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>LUCRO LÍQUIDO REAL</small>
                    <span class="value" id="dash-profit">R$ 0,00</span>
                </div>
                <div class="kpi-card">
                    <small>PEDIDOS ATIVOS (PROD/APROV)</small>
                    <span class="value" id="dash-active-orders">0</span>
                </div>
                <div class="kpi-card">
                    <small>CONVERSÃO DE LEADS</small>
                    <span class="value" id="dash-conversion">0%</span>
                </div>
            </div>
            <div class="charts-row">
                <div class="chart-container">
                    <h3>Tendência Financeira</h3>
                    <div class="chart-wrapper"><canvas id="trendChart"></canvas></div>
                </div>
                <div class="chart-container">
                    <h3>Origem dos Leads</h3>
                    <div class="chart-wrapper"><canvas id="originChart"></canvas></div>
                </div>
            </div>
            <div class="dashboard-bottom-row">
                <div class="chart-container timeline-widget">
                    <h3>Cronograma de Entregas</h3>
                    <div id="timeline-list" class="timeline-container">
                        <!-- Timeline via JS -->
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Lucro por Categoria</h3>
                    <div class="chart-wrapper"><canvas id="categoryChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- CRM -->
        <section id="crm" class="content-section">
            <header>
                <h2>CRM - FUNIL DE VENDAS</h2>
                <div class="header-actions">
                    <button class="btn-modern btn-primary" onclick="openLeadModal()"><i class="fas fa-plus"></i> NOVO CLIENTE</button>
                    <button class="btn-modern" onclick="toggleCRMView()"><i class="fas fa-table"></i> ALTERNAR VISÃO</button>
                </div>
            </header>
            <div id="kanban-view" class="kanban-container">
                <!-- Colunas via JS -->
            </div>
            <div id="table-view" style="display:none;">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Empresa</th>
                            <th>Status</th>
                            <th>Valor</th>
                            <th>Entrega</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- CALCULADORA -->
        <section id="calculator" class="content-section">
            <header>
                <h2>CALCULADORA DE ORÇAMENTOS</h2>
                <div class="header-actions">
                    <select id="g_vincular_lead" onchange="loadLeadDataIntoCalc()">
                        <option value="">-- Criar Novo Lead --</option>
                    </select>
                    <button class="btn-modern btn-success" onclick="saveToCRM()"><i class="fas fa-save"></i> SALVAR NO CRM</button>
                </div>
            </header>
            <div class="calc-main-layout">
                <div class="calc-form-side">
                    <div class="section-header">Configurações Globais</div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Valor da Hora (R$)</label>
                            <input type="number" id="g_valor_hora" value="100" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label>Imposto (%)</label>
                            <input type="number" id="g_imposto" value="6" oninput="calc()">
                        </div>
                    </div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Taxa Cartão (%)</label>
                            <input type="number" id="g_cartao" value="5" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label>Markup Global (x)</label>
                            <input type="number" id="g_markup" value="2.0" step="0.1" oninput="calc()">
                        </div>
                    </div>

                    <div class="section-header">Dados do Cliente</div>
                    <div class="field-group">
                        <label>Nome do Cliente</label>
                        <input type="text" id="g_cliente" placeholder="Nome Completo" oninput="updateQuote()">
                    </div>
                    <div class="field-group">
                        <label>Empresa</label>
                        <input type="text" id="g_empresa_calc" placeholder="Empresa do Cliente" oninput="updateQuote()">
                    </div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Data da Proposta</label>
                            <input type="date" id="g_data_proposta" oninput="updateQuote()">
                        </div>
                        <div class="field-group">
                            <label>WhatsApp (Ex: 47999999999)</label>
                            <input type="text" id="g_whatsapp" placeholder="Apenas números" oninput="updateQuote()">
                        </div>
                    </div>

                    <div class="section-header">Itens do Orçamento</div>
                    <div id="items-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%" onclick="addItem()"><i class="fas fa-plus"></i> ADICIONAR ITEM</button>

                    <div class="section-header">Frete e Desconto</div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Frete Insumos (R$)</label>
                            <input type="number" id="g_frete_insumos" value="0" oninput="calc()">
                        </div>
                        <div class="field-group">
                            <label>Frete Cliente (R$)</label>
                            <input type="number" id="g_frete_cliente" value="0" oninput="calc()">
                        </div>
                    </div>
                    <div class="field-group">
                        <label>Desconto (%)</label>
                        <input type="number" id="g_desconto" value="0" oninput="calc()">
                    </div>

                    <div class="intel-box">
                        <div class="section-header" style="margin-top:0; border:none;">Inteligência de Custos</div>
                        <div class="intel-grid">
                            <div class="intel-item"><span>Tempo Total</span><strong id="res_tempo">0 min</strong></div>
                            <div class="intel-item"><span>Custo Tempo</span><strong id="res_custo_tempo">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Custo Material</span><strong id="res_custo_mat">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Impostos</span><strong id="res_impostos">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Custo Geral</span><strong id="res_custo_geral">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Lucro Real</span><strong id="res_lucro_real">R$ 0,00</strong></div>
                        </div>
                        <div id="markup-indicator" class="markup-indicator">MARKUP: 0.0x</div>
                    </div>
                </div>

                <div class="calc-preview-side">
                    <div id="quote-card" class="quote-card">
                        <div class="quote-header">
                            <div class="quote-meta">
                                <h2>ORÇAMENTO</h2>
                                <p id="q_data">Data: --/--/----</p>
                            </div>
                            <div class="quote-company">
                                <strong>SANTO LASER</strong><br>
                                <small>Corte e Gravação UV</small>
                            </div>
                        </div>
                        <div class="quote-client-box">
                            <strong>Para:</strong> <span id="q_nome">Cliente não informado</span><br>
                            <strong>Ref:</strong> Proposta de Serviços de Laser
                        </div>
                        <table class="quote-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Qtd</th>
                                    <th>Unitário</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="quote-items-body"></tbody>
                        </table>
                        <div class="quote-footer">
                            <div class="quote-total-row">
                                <span>TOTAL DO INVESTIMENTO</span>
                                <h3 id="q_total">R$ 0,00</h3>
                            </div>
                            <div class="quote-disclaimer">
                                <p id="q_cnpj">CNPJ: 00.000.000/0001-00</p>
                                <p id="q_whatsapp_link">WhatsApp: (00) 00000-0000</p>
                                <br>
                                <small>Validade da proposta: 7 dias. Condições sujeitas a alteração.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FLUXO DE CAIXA -->
        <section id="cashflow" class="content-section">
            <header>
                <h2>FLUXO DE CAIXA</h2>
                <div class="header-filters">
                    <input type="date" id="flow-start" onchange="renderFinance()">
                    <span>até</span>
                    <input type="date" id="flow-end" onchange="renderFinance()">
                    <select id="flow-type-filter" onchange="renderFinance()">
                        <option value="">Todos os Tipos</option>
                        <option value="entrada">Entradas</option>
                        <option value="saída">Saídas</option>
                    </select>
                </div>
            </header>
            <div class="dual-layout">
                <div class="form-panel">
                    <div class="section-header">Nova Transação</div>
                    <div class="field-group">
                        <label>Descrição</label>
                        <input type="text" id="f_desc" placeholder="Ex: Compra de MDF">
                    </div>
                    <div class="field-row">
                        <div class="field-group">
                            <label>Valor (R$)</label>
                            <input type="number" id="f_val">
                        </div>
                        <div class="field-group">
                            <label>Tipo</label>
                            <select id="f_tipo">
                                <option value="entrada">Entrada</option>
                                <option value="saída">Saída</option>
                            </select>
                        </div>
                    </div>
                    <div class="field-group">
                        <label>Categoria</label>
                        <select id="f_cat"></select>
                    </div>
                    <div class="field-group">
                        <label>Data</label>
                        <input type="date" id="f_data">
                    </div>
                    <button class="btn-modern btn-primary" style="width:100%" onclick="addFinance()"><i class="fas fa-plus"></i> ADICIONAR</button>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid var(--border);">
                    <button class="btn-modern" style="width:100%" onclick="openBalanceModal()"><i class="fas fa-wallet"></i> AJUSTAR SALDO INICIAL</button>
                </div>
                <div class="data-panel">
                    <div class="kpi-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="kpi-card highlight-neon"><small>SALDO ATUAL</small><span class="value" id="f_res_saldo">R$ 0,00</span></div>
                        <div class="kpi-card"><small>ENTRADAS</small><span class="value" id="f_res_ent">R$ 0,00</span></div>
                        <div class="kpi-card"><small>SAÍDAS</small><span class="value" id="f_res_sai">R$ 0,00</span></div>
                    </div>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descrição</th>
                                    <th>Categoria</th>
                                    <th>Tipo</th>
                                    <th>Valor</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="finance-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- DRE -->
        <section id="dre" class="content-section">
            <header>
                <h2>DEMONSTRATIVO DE RESULTADO</h2>
                <div class="header-filters">
                    <input type="month" id="dre-month-filter" onchange="renderDRE()">
                </div>
            </header>
            <div class="dual-layout">
                <div class="form-panel">
                    <div class="kpi-grid" style="grid-template-columns: 1fr;">
                        <div class="kpi-card highlight-neon"><small>RESULTADO LÍQUIDO</small><span class="value" id="dre-resultado">R$ 0,00</span></div>
                    </div>
                    <div class="chart-container">
                        <h3>Performance Financeira</h3>
                        <div class="chart-wrapper"><canvas id="chart-performance"></canvas></div>
                    </div>
                    <div class="chart-container">
                        <h3>Previsibilidade</h3>
                        <div class="chart-wrapper"><canvas id="chart-previsibilidade"></canvas></div>
                    </div>
                </div>
                <div class="data-panel">
                    <table class="modern-table">
                        <thead>
                            <tr><th>Indicador</th><th>Valor</th><th>% sobre Receita Bruta</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Receita Bruta</td><td id="dre-receita-bruta">R$ 0,00</td><td id="dre-receita-bruta-p">100%</td></tr>
                            <tr><td>(-) Impostos</td><td id="dre-impostos">R$ 0,00</td><td id="dre-impostos-p">0%</td></tr>
                            <tr><td>= Receita Líquida</td><td id="dre-receita-liquida">R$ 0,00</td><td id="dre-receita-liquida-p">0%</td></tr>
                            <tr><td>(-) Custo dos Produtos Vendidos (CPV)</td><td id="dre-cpv">R$ 0,00</td><td id="dre-cpv-p">0%</td></tr>
                            <tr><td>= Lucro Bruto</td><td id="dre-lucro-bruto">R$ 0,00</td><td id="dre-lucro-bruto-p">0%</td></tr>
                            <tr><td>(-) Despesas Operacionais</td><td id="dre-despesas">R$ 0,00</td><td id="dre-despesas-p">0%</td></tr>
                            <tr><td>= Resultado Líquido</td><td id="dre-resultado-final">R$ 0,00</td><td id="dre-resultado-final-p">0%</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- SIMULADOR DE METAS -->
        <section id="goals" class="content-section">
            <header>
                <h2>SIMULADOR DE METAS</h2>
                <button class="btn-modern btn-primary" onclick="addSimItem()"><i class="fas fa-plus"></i> ADICIONAR META</button>
            </header>
            <div class="dual-layout">
                <div class="form-panel">
                    <div class="field-group">
                        <label>Meta de Faturamento (R$)</label>
                        <input type="number" id="sim-meta-faturamento" value="10000" oninput="calculateSim()">
                    </div>
                    <div class="field-group">
                        <label>Markup Médio Desejado (x)</label>
                        <input type="number" id="sim-markup-medio" value="2.5" step="0.1" oninput="calculateSim()">
                    </div>
                    <div class="section-header">Custos Fixos e Variáveis</div>
                    <div id="sim-items-container"></div>
                    <div class="intel-box">
                        <div class="section-header" style="margin-top:0; border:none;">Resultados da Simulação</div>
                        <div class="intel-grid">
                            <div class="intel-item"><span>Custo Total Projetado</span><strong id="sim-custo-total">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Lucro Líquido Projetado</span><strong id="sim-lucro-liquido">R$ 0,00</strong></div>
                            <div class="intel-item"><span>Pedidos Necessários</span><strong id="sim-pedidos-necessarios">0</strong></div>
                        </div>
                    </div>
                </div>
                <div class="data-panel">
                    <div class="chart-container">
                        <h3>Composição de Custos</h3>
                        <div class="chart-wrapper"><canvas id="chart-sim-custos"></canvas></div>
                    </div>
                    <div class="chart-container">
                        <h3>Projeção de Lucro</h3>
                        <div class="chart-wrapper"><canvas id="chart-sim-lucro"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ESTOQUE -->
        <section id="inventory" class="content-section">
            <header>
                <h2>CONTROLE DE ESTOQUE</h2>
                <button class="btn-modern btn-primary" onclick="openStockModal()"><i class="fas fa-plus"></i> NOVO ITEM</button>
            </header>
            <div class="table-container">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantidade</th>
                            <th>Unidade</th>
                            <th>Custo Unitário</th>
                            <th>Custo Total</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- CONFIGURAÇÕES -->
        <section id="settings" class="content-section">
            <header>
                <h2>CONFIGURAÇÕES DO SISTEMA</h2>
            </header>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>Etapas do CRM</h3>
                    <div id="settings-crm-steps"></div>
                    <div class="setting-item-row">
                        <input type="text" id="new-crm-step" placeholder="Nova Etapa" class="neon-input">
                        <button class="btn-modern btn-primary" onclick="addCrmStep()"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <div class="settings-card">
                    <h3>Categorias Financeiras</h3>
                    <div id="settings-finance-cats"></div>
                    <div class="setting-item-row">
                        <input type="text" id="new-finance-cat" placeholder="Nova Categoria" class="neon-input">
                        <button class="btn-modern btn-primary" onclick="addFinanceCat()"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <div class="settings-card">
                    <h3>Configurações da Calculadora</h3>
                    <div class="field-group">
                        <label>Valor da Hora Padrão (R$)</label>
                        <input type="number" id="setting-hora" oninput="updateSetting(\'hora\', this.value)">
                    </div>
                    <div class="field-group">
                        <label>Imposto Padrão (%)</label>
                        <input type="number" id="setting-imposto" oninput="updateSetting(\'imposto\', this.value)">
                    </div>
                    <div class="field-group">
                        <label>Markup Padrão (x)</label>
                        <input type="number" id="setting-markup" oninput="updateSetting(\'markup\', this.value)">
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modais -->
    <div class="modal-overlay" id="modal-overlay"></div>

    <!-- Modal Lead -->
    <div class="modal-modern" id="lead-modal">
        <h3>NOVO/EDITAR LEAD</h3>
        <div class="field-group"><label>Cliente</label><input type="text" id="lead-cliente"></div>
        <div class="field-group"><label>Empresa</label><input type="text" id="lead-empresa"></div>
        <div class="field-group"><label>Valor</label><input type="number" id="lead-valor"></div>
        <div class="field-group"><label>Status</label><select id="lead-status"></select></div>
        <div class="field-group"><label>Entrega</label><input type="date" id="lead-entrega"></div>
        <div class="field-group"><label>Origem</label><input type="text" id="lead-origem"></div>
        <div class="field-group"><label>Resultado</label><select id="lead-resultado"><option value="Pendente">Pendente</option><option value="Venda">Venda</option><option value="Perda">Perda</option></select></div>
        <button class="btn-modern btn-primary" style="width:100%; margin-top: 20px;" onclick="saveLead()"><i class="fas fa-save"></i> SALVAR LEAD</button>
    </div>

    <!-- Modal Transação Financeira -->
    <div class="modal-modern" id="transaction-modal">
        <h3>NOVA TRANSAÇÃO</h3>
        <div class="field-group"><label>Descrição</label><input type="text" id="trans-desc"></div>
        <div class="field-group"><label>Valor</label><input type="number" id="trans-valor"></div>
        <div class="field-group"><label>Tipo</label><select id="trans-tipo"><option value="entrada">Entrada</option><option value="saída">Saída</option></select></div>
        <div class="field-group"><label>Categoria</label><select id="trans-cat"></select></div>
        <div class="field-group"><label>Data</label><input type="date" id="trans-data"></div>
        <button class="btn-modern btn-primary" style="width:100%; margin-top: 20px;" onclick="saveTransaction()"><i class="fas fa-save"></i> SALVAR TRANSAÇÃO</button>
    </div>

    <!-- Modal Ajustar Saldo Inicial -->
    <div class="modal-modern" id="balance-modal">
        <h3>AJUSTAR SALDO INICIAL</h3>
        <div class="field-group"><label>Saldo Inicial (R$)</label><input type="number" id="initial-balance-input"></div>
        <button class="btn-modern btn-primary" style="width:100%; margin-top: 20px;" onclick="saveInitialBalance()"><i class="fas fa-save"></i> SALVAR SALDO</button>
    </div>

    <!-- Modal Estoque -->
    <div class="modal-modern" id="stock-modal">
        <h3>NOVO/EDITAR ITEM DE ESTOQUE</h3>
        <div class="field-group"><label>Nome do Item</label><input type="text" id="stock-nome"></div>
        <div class="field-group"><label>Quantidade</label><input type="number" id="stock-qtd"></div>
        <div class="field-group"><label>Unidade</label><input type="text" id="stock-unidade"></div>
        <div class="field-group"><label>Custo Unitário (R$)</label><input type="number" id="stock-custo-unitario"></div>
        <button class="btn-modern btn-primary" style="width:100%; margin-top: 20px;" onclick="saveStockItem()"><i class="fas fa-save"></i> SALVAR ITEM</button>
    </div>

    <script src="script.js"></script>
</body>
</html>
