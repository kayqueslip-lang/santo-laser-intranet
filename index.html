<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santo Laser - BI & ERP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <aside class="sidebar">
        <div class="logo-container">
            <div class="logo-circle">
                <img id="main-logo-img" src="" alt="Santo Laser Logo" class="main-logo">
            </div>
            <h1 class="sidebar-title">SANTO LASER</h1>
        </div>
        <div class="search-box">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="global-search" placeholder="Buscar cliente..." oninput="globalSearch()">
        </div>
        <nav>
            <a href="#" class="nav-item active" onclick="showSection('dashboard')"><i class="fa-solid fa-chart-line"></i> DASHBOARD</a>
            <a href="#" class="nav-item" onclick="showSection('crm')"><i class="fa-solid fa-users"></i> CRM</a>
            <a href="#" class="nav-item" onclick="showSection('calculator')"><i class="fa-solid fa-calculator"></i> CALCULADORA OS</a>
            <a href="#" class="nav-item" onclick="showSection('cashflow')"><i class="fa-solid fa-money-bill-transfer"></i> FLUXO DE CAIXA</a>
            <a href="#" class="nav-item" onclick="showSection('dre')"><i class="fa-solid fa-file-invoice-dollar"></i> DRE</a>
            <a href="#" class="nav-item" onclick="showSection('simulator')"><i class="fa-solid fa-bullseye"></i> SIMULADOR METAS</a>
            <a href="#" class="nav-item" onclick="showSection('stock')"><i class="fa-solid fa-boxes-stacked"></i> ESTOQUE</a>
            <a href="#" class="nav-item" onclick="showSection('settings')"><i class="fa-solid fa-gear"></i> CONFIGURA√á√ïES</a>
        </nav>
        <div class="sidebar-footer">
            <button class="btn-modern" style="width:100%; margin-bottom:10px;" onclick="exportToExcel()"><i class="fa-solid fa-file-excel"></i> EXPORTAR EXCEL</button>
            <div class="theme-switch">
                <button id="theme-toggle" class="btn-theme" onclick="toggleTheme()">
                    <i class="fa-solid fa-moon"></i> <span>MODO ESCURO</span>
                </button>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <!-- DASHBOARD -->
        <div id="dashboard-content" class="content-section active">
            <header>
                <h2>INTELIG√äNCIA DE NEG√ìCIO</h2>
                <div class="filter-bar">
                    <input type="month" id="dash-month-filter" onchange="updateDashboard()">
                </div>
            </header>
            <div class="kpi-grid">
                <div class="kpi-card highlight-neon">
                    <small>Faturamento (Vendas)</small>
                    <span class="value" id="dash-faturamento">R$ 0,00</span>
                    <div class="kpi-trend" id="dash-faturamento-trend">Previs√£o: R$ 0,00</div>
                </div>
                <div class="kpi-card">
                    <small>Lucro L√≠quido Real</small>
                    <span class="value" id="dash-lucro-real">R$ 0,00</span>
                    <div class="kpi-trend" id="dash-lucro-margem">Margem: 0%</div>
                </div>
                <div class="kpi-card">
                    <small>Pipeline (Oportunidades)</small>
                    <span class="value" id="dash-pipeline">R$ 0,00</span>
                    <div class="kpi-trend">Em negocia√ß√£o</div>
                </div>
                <div class="kpi-card">
                    <small>Pedidos em Produ√ß√£o</small>
                    <span class="value" id="dash-pedidos">0</span>
                    <div class="kpi-trend" id="dash-pedidos-valor">R$ 0,00</div>
                </div>
            </div>
            <div class="charts-row">
                <div class="chart-container">
                    <h3>Fluxo de Caixa Mensal</h3>
                    <div class="chart-wrapper"><canvas id="chart-performance"></canvas></div>
                </div>
                <div class="chart-container">
                    <h3>Previsibilidade de Receita</h3>
                    <div class="chart-wrapper"><canvas id="chart-previsibilidade"></canvas></div>
                </div>
            </div>
            <div class="dashboard-bottom-row">
                <div class="chart-container timeline-widget">
                    <h3>Cronograma de Entregas</h3>
                    <div id="timeline-wrapper" class="timeline-container"></div>
                </div>
                <div class="chart-container">
                    <h3>Origem de Leads</h3>
                    <div class="chart-wrapper"><canvas id="chart-origem"></canvas></div>
                </div>
            </div>
        </div>

        <!-- CRM -->
        <div id="crm-content" class="content-section">
            <div class="crm-header">
                <h2>GEST√ÉO DE OPORTUNIDADES</h2>
                <div class="crm-controls">
                    <button class="btn-modern btn-primary" onclick="openLeadModal()">+ NOVO CLIENTE</button>
                    <button class="btn-modern" onclick="toggleCRMView()"><i class="fa-solid fa-table-list"></i> ALTERNAR VIS√ÉO</button>
                </div>
            </div>
            <div id="kanban-view" class="kanban-container">
                <div class="kanban-column" id="col-0" ondrop="drop(event, 0)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-1">PROPOSTA</span> <span class="count" id="count-0">0</span></div>
                    <div class="kanban-cards" id="cards-0"></div>
                </div>
                <div class="kanban-column" id="col-1" ondrop="drop(event, 1)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-2">APROVADO</span> <span class="count" id="count-1">0</span></div>
                    <div class="kanban-cards" id="cards-1"></div>
                </div>
                <div class="kanban-column" id="col-2" ondrop="drop(event, 2)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-3">PRODU√á√ÉO</span> <span class="count" id="count-2">0</span></div>
                    <div class="kanban-cards" id="cards-2"></div>
                </div>
                <div class="kanban-column" id="col-3" ondrop="drop(event, 3)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-4">FINALIZADO</span> <span class="count" id="count-3">0</span></div>
                    <div class="kanban-cards" id="cards-3"></div>
                </div>
                <div class="kanban-column" id="col-4" ondrop="drop(event, 4)" ondragover="allowDrop(event)">
                    <div class="column-header"><span id="label-step-5">PAGO</span> <span class="count" id="count-4">0</span></div>
                    <div class="kanban-cards" id="cards-4"></div>
                </div>
            </div>
            <div id="table-view" class="table-container" style="display: none;">
                <table class="modern-table">
                    <thead><tr><th>CLIENTE</th><th>EMPRESA</th><th>STATUS</th><th>VALOR</th><th>ENTREGA</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="crm-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- CALCULADORA -->
        <div id="calculator-content" class="content-section">
            <div class="calc-main-layout">
                <div class="calc-form-side">
                    <div class="section-header">üîó V√≠nculo de Intelig√™ncia</div>
                    <div class="field-group">
                        <label>Vincular a Lead Existente?</label>
                        <select id="g_vincular_lead" onchange="loadLeadDataIntoCalc()">
                            <option value="">-- Criar Novo Lead --</option>
                        </select>
                    </div>
                    <div class="section-header">‚öôÔ∏è Par√¢metros de Custo</div>
                    <div class="field-row">
                        <div class="field-group"><label>Valor Hora (R$)</label><input type="number" id="g_valor_hora" value="100" oninput="calc()"></div>
                        <div class="field-group"><label>Imposto (%)</label><input type="number" id="g_imposto" value="6" oninput="calc()"></div>
                    </div>
                    <div class="field-row">
                        <div class="field-group"><label>Taxa Cart√£o (%)</label><input type="number" id="g_cartao" value="5" oninput="calc()"></div>
                        <div class="field-group"><label>Frete Insumos (R$)</label><input type="number" id="g_frete" value="0" oninput="calc()"></div>
                    </div>
                    <div class="section-header">üë§ Dados do Cliente</div>
                    <div class="field-group"><label>Nome do Cliente</label><input type="text" id="g_cliente" placeholder="Nome Completo" oninput="calc()"></div>
                    <div class="field-row">
                        <div class="field-group"><label>Empresa</label><input type="text" id="g_empresa_calc" placeholder="Opcional" oninput="calc()"></div>
                        <div class="field-group"><label>Data da Proposta</label><input type="date" id="g_data_proposta" oninput="calc()"></div>
                    </div>
                    <div class="section-header">üíé Itens do Or√ßamento</div>
                    <div id="items-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addItem()">+ ADICIONAR ITEM</button>
                    <div class="section-header">üöö Log√≠stica e Descontos</div>
                    <div class="field-row">
                        <div class="field-group"><label>Frete Cliente (R$)</label><input type="number" id="g_frete_cliente" value="0" oninput="calc()"></div>
                        <div class="field-group"><label>Desconto (%)</label><input type="number" id="g_desconto" value="0" oninput="calc()"></div>
                    </div>
                </div>
                <div class="calc-preview-side">
                    <div class="quote-card-container">
                        <div class="quote-card" id="quote-card">
                            <div class="quote-header">
                                <div class="quote-logo-box"><img id="quote-logo-img" src="" alt="Logo"></div>
                                <div class="quote-meta">
                                    <h2>OR√áAMENTO</h2>
                                    <p id="display_data_proposta"></p>
                                </div>
                            </div>
                            <div class="quote-client-box">
                                <strong>CLIENTE:</strong> <span id="display_nome_cliente"></span><br>
                                <span id="display_empresa_cliente" style="font-size: 0.65rem; opacity: 0.8;"></span>
                            </div>
                            <table class="quote-table">
                                <thead><tr><th>QTD</th><th>DESCRI√á√ÉO</th><th>TOTAL</th></tr></thead>
                                <tbody id="card-body"></tbody>
                            </table>
                            <div class="quote-footer">
                                <div class="quote-total-row"><span>TOTAL FINAL</span><span id="card_total">R$ 0,00</span></div>
                                <div class="quote-intelligence-box" id="quote-intelligence">
                                    <div class="intel-row"><span>Impostos Totais:</span> <span id="intel-impostos">R$ 0,00</span></div>
                                    <div class="intel-row"><span>Custo de Produ√ß√£o (CPV):</span> <span id="intel-cpv">R$ 0,00</span></div>
                                    <div class="intel-row"><span>Lucro Real Estimado:</span> <span id="intel-lucro" style="color:var(--success); font-weight:bold;">R$ 0,00</span></div>
                                </div>
                                <div class="quote-company-info">SANTO LASER | CNPJ: 64.544.332/0001-10</div>
                            </div>
                        </div>
                    </div>
                    <div class="calc-actions">
                        <button class="btn-modern btn-primary" onclick="copyWA()"><i class="fa-brands fa-whatsapp"></i> WHATSAPP</button>
                        <button class="btn-modern btn-success" id="btn-sync-crm" onclick="sendToCRM()"><i class="fa-solid fa-cloud-arrow-up"></i> ATUALIZAR CRM</button>
                        <button class="btn-modern" onclick="window.print()"><i class="fa-solid fa-file-pdf"></i> PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- FLUXO DE CAIXA -->
        <div id="cashflow-content" class="content-section">
            <div class="crm-header">
                <h2>FLUXO DE CAIXA & RESERVAS</h2>
                <div class="cashflow-controls">
                    <button class="btn-modern" onclick="openInitialBalanceModal()">SALDO INICIAL</button>
                    <button class="btn-modern btn-primary" onclick="openFinanceModal('Entrada')">+ ENTRADA</button>
                    <button class="btn-modern btn-danger" onclick="openFinanceModal('Sa√≠da')">- SA√çDA</button>
                </div>
            </div>
            <div class="finance-kpis">
                <div class="kpi-card"><small>Saldo em Conta</small><span class="value" id="fin-saldo">R$ 0,00</span></div>
                <div class="kpi-card"><small>Reserva Seguran√ßa</small><span class="value" id="fin-reserva" style="color:var(--warning)">R$ 0,00</span></div>
                <div class="kpi-card"><small>Provis√£o Impostos</small><span class="value" id="fin-impostos" style="color:var(--danger)">R$ 0,00</span></div>
                <div class="kpi-card"><small>Lucro Acumulado</small><span class="value" id="fin-lucro" style="color:var(--success)">R$ 0,00</span></div>
            </div>
            <div class="filter-bar">
                <div class="filter-group"><label>In√≠cio</label><input type="date" id="filter-start" onchange="renderFinance()"></div>
                <div class="filter-group"><label>Fim</label><input type="date" id="filter-end" onchange="renderFinance()"></div>
                <div class="filter-group">
                    <label>Tipo</label>
                    <select id="filter-type" onchange="renderFinance()">
                        <option value="">Todos</option>
                        <option value="Entrada">Entradas</option>
                        <option value="Sa√≠da">Sa√≠das</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Categoria</label>
                    <select id="filter-cat" onchange="renderFinance()">
                        <option value="">Todas</option>
                    </select>
                </div>
                <button class="btn-modern" style="margin-top:20px;" onclick="clearFinanceFilters()">LIMPAR</button>
            </div>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>DATA</th><th>DESCRI√á√ÉO</th><th>TIPO</th><th>CATEGORIA</th><th>VALOR</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="finance-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- DRE -->
        <div id="dre-content" class="content-section">
            <header>
                <h2>DEMONSTRATIVO DE RESULTADOS (DRE)</h2>
                <div class="filter-bar">
                    <input type="month" id="dre-month-filter" onchange="renderDRE()">
                </div>
            </header>
            <div class="dre-container">
                <table class="dre-table">
                    <tr class="dre-row-main"><td>RECEITA BRUTA OPERACIONAL</td><td id="dre-receita-bruta">R$ 0,00</td><td class="perc">100%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Dedu√ß√µes e Impostos</td><td id="dre-impostos">R$ 0,00</td><td class="perc" id="dre-impostos-p">0%</td></tr>
                    <tr class="dre-row-total"><td>RECEITA L√çQUIDA</td><td id="dre-receita-liquida">R$ 0,00</td><td class="perc" id="dre-receita-liquida-p">0%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Custo de Produtos Vendidos (CPV)</td><td id="dre-cpv">R$ 0,00</td><td class="perc" id="dre-cpv-p">0%</td></tr>
                    <tr class="dre-row-total"><td>LUCRO BRUTO</td><td id="dre-lucro-bruto">R$ 0,00</td><td class="perc" id="dre-lucro-bruto-p">0%</td></tr>
                    <tr class="dre-row-sub"><td>(-) Despesas Operacionais / Fixas</td><td id="dre-despesas">R$ 0,00</td><td class="perc" id="dre-despesas-p">0%</td></tr>
                    <tr class="dre-row-final"><td>RESULTADO L√çQUIDO DO PER√çODO</td><td id="dre-resultado">R$ 0,00</td><td class="perc" id="dre-resultado-p">0%</td></tr>
                </table>
            </div>
        </div>

        <!-- SIMULADOR METAS -->
        <div id="simulator-content" class="content-section">
            <header><h2>SIMULADOR DE METAS FINANCEIRAS</h2></header>
            <div class="sim-layout">
                <div class="sim-inputs-card">
                    <h3>üéØ Metas Desejadas</h3>
                    <div id="sim-dynamic-labels"></div>
                    <div class="sim-total-meta">
                        <small>META DE LUCRO TOTAL</small>
                        <span id="sim-meta-total">R$ 0,00</span>
                    </div>
                </div>
                <div class="sim-results-card">
                    <h3>üìä Planejamento de Produtos/Servi√ßos</h3>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead><tr><th>NOME</th><th>PRE√áO VENDA</th><th>MARGEM (%)</th><th>VENDAS ATUAIS</th><th>VENDAS NECESS√ÅRIAS</th><th>A√á√ïES</th></tr></thead>
                            <tbody id="sim-table-body"></tbody>
                        </table>
                    </div>
                    <button class="btn-modern btn-primary" style="margin-top:10px;" onclick="addSimItem()">+ ADICIONAR PRODUTO</button>
                </div>
            </div>
        </div>

        <!-- ESTOQUE -->
        <div id="stock-content" class="content-section">
            <div class="crm-header">
                <h2>CONTROLE DE ESTOQUE</h2>
                <button class="btn-modern btn-primary" onclick="openStockModal()">+ NOVO ITEM</button>
            </div>
            <div class="table-container">
                <table class="modern-table">
                    <thead><tr><th>ITEM</th><th>CATEGORIA</th><th>QTD ATUAL</th><th>M√çNIMO</th><th>VALOR UNIT.</th><th>TOTAL</th><th>A√á√ïES</th></tr></thead>
                    <tbody id="stock-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- CONFIGURA√á√ïES -->
        <div id="settings-content" class="content-section">
            <header><h2>CONFIGURA√á√ïES & CUSTOMIZA√á√ÉO</h2></header>
            <div class="settings-grid">
                <div class="settings-card">
                    <h3><i class="fa-solid fa-list-check"></i> Personalizar Etapas CRM</h3>
                    <div id="settings-steps-list" class="settings-inputs-list"></div>
                </div>
                <div class="settings-card">
                    <h3><i class="fa-solid fa-tags"></i> R√≥tulos do Simulador</h3>
                    <div id="settings-sim-labels" class="settings-inputs-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addSettingItem('simLabels')">+ ADICIONAR R√ìTULO</button>
                </div>
                <div class="settings-card">
                    <h3><i class="fa-solid fa-money-bill-wave"></i> Categorias Financeiras</h3>
                    <div id="settings-categories-list" class="settings-inputs-list"></div>
                    <button class="btn-modern btn-primary" style="width:100%; margin-top:10px;" onclick="addSettingItem('categories')">+ ADICIONAR CATEGORIA</button>
                </div>
                <div class="settings-card">
                    <h3><i class="fa-solid fa-trash-can"></i> Manuten√ß√£o</h3>
                    <p style="font-size:0.7rem; color:var(--text-secondary); margin-bottom:15px;">Limpa todos os dados salvos localmente.</p>
                    <button class="btn-modern btn-danger" onclick="resetSystem()" style="width:100%">LIMPAR TODO O SISTEMA</button>
                </div>
            </div>
        </div>
    </main>

    <!-- MODAIS -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeAllModals()">
        <div id="lead-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3 id="lead-modal-title">LEAD</h3><button class="close-btn" onclick="closeLeadModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Nome do Cliente</label><input type="text" id="m_cliente"></div>
                <div class="field-row">
                    <div class="field-group"><label>Empresa</label><input type="text" id="m_empresa"></div>
                    <div class="field-group"><label>Etapa Atual</label><select id="m_status"></select></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Origem do Lead</label><select id="m_origem"><option value="WhatsApp">WhatsApp</option><option value="Instagram">Instagram</option><option value="Indica√ß√£o">Indica√ß√£o</option><option value="Site">Site</option><option value="Outros">Outros</option></select></div>
                    <div class="field-group"><label>Previs√£o Entrega</label><input type="date" id="m_entrega"></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Valor Bruto (R$)</label><input type="number" id="m_valor"></div>
                    <div class="field-group"><label>Lucro Estimado (R$)</label><input type="number" id="m_lucro"></div>
                </div>
                
                <div class="section-header" style="margin-top:15px; font-size:0.75rem;">üìä INTELIG√äNCIA DE CUSTOS (VIA CALCULADORA)</div>
                <div class="intel-grid-modal">
                    <div class="intel-item-modal">
                        <small>Impostos</small>
                        <span id="m_intel_impostos">R$ 0,00</span>
                    </div>
                    <div class="intel-item-modal">
                        <small>CPV (Custos)</small>
                        <span id="m_intel_cpv">R$ 0,00</span>
                    </div>
                    <div class="intel-item-modal">
                        <small>Lucro Real</small>
                        <span id="m_intel_lucro" style="color:var(--success)">R$ 0,00</span>
                    </div>
                </div>

                <div class="result-actions" id="lead-result-actions" style="display: none; margin-top:20px;">
                    <button id="btn-venda" class="btn-modern" onclick="setResult('Venda')">MARCAR VENDA</button>
                    <button id="btn-perda" class="btn-modern" onclick="setResult('Perda')">MARCAR PERDA</button>
                </div>
                <input type="hidden" id="m_lead_id"><input type="hidden" id="m_resultado">
                <input type="hidden" id="m_impostos"><input type="hidden" id="m_cpv">
            </div>
            <div class="modal-footer"><button class="btn-modern btn-danger" id="btn-delete-lead" onclick="deleteLead()">EXCLUIR</button><div style="display:flex; gap:10px;"><button class="btn-modern" onclick="closeLeadModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveLead()">SALVAR</button></div></div>
        </div>

        <div id="finance-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3 id="fin-modal-title">LAN√áAMENTO</h3><button class="close-btn" onclick="closeFinanceModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Descri√ß√£o</label><input type="text" id="f_desc"></div>
                <div class="field-row">
                    <div class="field-group"><label>Valor (R$)</label><input type="number" id="f_valor"></div>
                    <div class="field-group"><label>Categoria</label><select id="f_cat_select"></select></div>
                </div>
                <div class="field-group"><label>Data</label><input type="date" id="f_data"></div>
                <input type="hidden" id="f_tipo">
            </div>
            <div class="modal-footer"><button class="btn-modern" onclick="closeFinanceModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveTransaction()">CONFIRMAR</button></div>
        </div>

        <div id="stock-modal" class="modal-modern" onclick="event.stopPropagation()">
            <div class="modal-header"><h3>ITEM DE ESTOQUE</h3><button class="close-btn" onclick="closeStockModal()">&times;</button></div>
            <div class="modal-body">
                <div class="field-group"><label>Nome</label><input type="text" id="s_nome"></div>
                <div class="field-row">
                    <div class="field-group"><label>Categoria</label><input type="text" id="s_cat"></div>
                    <div class="field-group"><label>Custo Unit.</label><input type="number" id="s_valor"></div>
                </div>
                <div class="field-row">
                    <div class="field-group"><label>Quantidade</label><input type="number" id="s_qtd"></div>
                    <div class="field-group"><label>M√≠nimo</label><input type="number" id="s_min"></div>
                </div>
                <input type="hidden" id="s_item_id">
            </div>
            <div class="modal-footer"><button class="btn-modern" onclick="closeStockModal()">CANCELAR</button><button class="btn-modern btn-primary" onclick="saveStockItem()">SALVAR</button></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
